<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>БАБЛО — casual clicker</title>
<style>
  :root{
    /* Палитра casual */
    --sky-top:#29b6ff;
    --sky-mid:#79dbff;
    --sky-bottom:#5ef0b7;
    --hill1:#32e39a;
    --hill2:#00c978;

    --btn1:#ff6b6b;   /* геймплейная кнопка — красный градиент (ярче) */
    --btn2:#ff2d2d;
    --btn3:#c40000;
    --btn-rim:#b36b00;

    --badge1:#2b2f55; /* бейдж баланса */
    --badge2:#181b33;
    --glow:#00ffb3;

    --withdraw1:#64ffb3;
    --withdraw2:#00d37a;

    --btn-size: clamp(220px, 70vw, 420px);
    --scale: 1; --cx: 30%; --cy: 25%;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
    color:#111;
    background:
      linear-gradient(180deg, var(--sky-top), var(--sky-mid) 45%, var(--sky-bottom) 70%) fixed no-repeat;
    overflow-x:hidden;
  }

  /* Милые облачка */
  .clouds{
    position:fixed; inset:0; overflow:hidden; pointer-events:none; z-index:0;
  }
  .cloud{
    position:absolute; top:10vh; width:220px; height:80px; background:rgba(255,255,255,.9);
    filter: blur(2px); border-radius:60px;
    box-shadow: 40px 10px 0 10px rgba(255,255,255,.85),
                90px -10px 0 20px rgba(255,255,255,.9),
                150px 10px 0 14px rgba(255,255,255,.82);
    opacity:.8; animation: drift 48s linear infinite;
  }
  .cloud.c2{ top:18vh; left:10vw; transform:scale(1.2); animation-duration: 60s; opacity:.7}
  .cloud.c3{ top:26vh; left:60vw; transform:scale(0.9); animation-duration: 54s; opacity:.75}
  @keyframes drift{
    0%{ transform: translateX(-40vw) scale(var(--s,1)); }
    100%{ transform: translateX(120vw) scale(var(--s,1)); }
  }

  .game{
    position:relative;
    width:min(720px, 100vw);
    min-height:100svh;
    margin:0 auto;
    padding: calc(10px + env(safe-area-inset-top)) 12px calc(24px + env(safe-area-inset-bottom));
    z-index:1;
  }

  /* ===== Бейдж баланса (слева-сверху) ===== */
  .cash{
    position:fixed;
    left: max(12px, env(safe-area-inset-left));
    top:  max(12px, calc(env(safe-area-inset-top) + 8px));
    display:flex; align-items:center; gap:10px;
    padding:10px 14px;
    border-radius:14px;
    background: linear-gradient(180deg, rgba(35,40,80,.85), rgba(16,18,36,.88));
    box-shadow:
      0 8px 24px rgba(0,0,0,.25),
      inset 0 1px 0 rgba(255,255,255,.16);
    color:#eef6ff;
    backdrop-filter: blur(6px);
  }
  .cash.glow{ box-shadow:
      0 10px 26px rgba(0,0,0,.25),
      0 0 28px 6px color-mix(in oklab, var(--glow) 50%, transparent),
      inset 0 1px 0 rgba(255,255,255,.16);
    transition: box-shadow .6s ease;
  }
  .cash-icon{
    width:36px; height:36px; border-radius:10px;
    display:grid; place-items:center;
    background: radial-gradient(90% 90% at 30% 25%, #fff59d, #ffd54f 35%, #ffb300 70%, #f57c00 100%);
    box-shadow: inset 0 -4px 10px rgba(0,0,0,.25), 0 4px 10px rgba(0,0,0,.25);
    color:#3b2b00; font-weight:900;
    text-shadow: 0 1px 0 rgba(255,255,255,.4);
  }
  .cash-amt{
    font-weight:800; letter-spacing:.2px;
    font-size: clamp(18px, 4.8vw, 22px);
    text-shadow: 0 1px 0 rgba(0,0,0,.35);
  }

  /* ===== Большая кнопка — внизу ===== */
  .bigbtn-wrap{
    position:fixed; left:50%;
    bottom: calc(16px + env(safe-area-inset-bottom));
    transform: translateX(-50%);
    display:grid; place-items:center; z-index:10; width:var(--btn-size);
  }
  .base{
    width:var(--btn-size); height: calc(var(--btn-size) * .22);
    background: radial-gradient(120% 160% at 50% 10%, #a6b2c0, #6f7a86);
    border-radius:999px; filter:drop-shadow(0 14px 24px rgba(0,0,0,.35));
  }
  .bigbtn{
    position:relative; display:grid; place-items:center;
    width:var(--btn-size); height:var(--btn-size);
    margin-top: calc(-1 * var(--btn-size) * .42);
    border-radius:50%; border:none; cursor:pointer; user-select:none;
    touch-action: manipulation;
    color:#ffffff; font-weight:900; font-size:clamp(54px, 15vw, 108px); letter-spacing:2px;
    text-shadow: 0 2px 0 rgba(255,255,255,.45);
    background:
      radial-gradient(120% 120% at var(--cx) var(--cy), var(--btn1) 0 35%, var(--btn2) 36% 60%, var(--btn3) 61% 100%);
    box-shadow:
      inset 0 -18px 28px rgba(0,0,0,.25),
      inset 0 12px 22px rgba(255,255,255,.25),
      0 18px 36px rgba(0,0,0,.35),
      0 0 0 6px rgba(139,94,0,.15);
    transform: scale(var(--scale));
    transition:
      transform 120ms cubic-bezier(.2,.8,.2,1),
      --cx 220ms cubic-bezier(.3,.7,.2,1),
      --cy 220ms cubic-bezier(.3,.7,.2,1),
      filter 120ms linear, box-shadow 120ms ease;
  }

  /* HUD над кнопкой */
  .hud{
    position:fixed; left:50%;
    bottom: calc(var(--btn-size) + 30px + env(safe-area-inset-bottom));
    transform: translateX(-50%);
    display:flex; flex-direction:column; align-items:center; gap:6px;
    width:min(90vw, 640px); text-align:center; z-index:9;
  }
  .multiplier{
    font-size:clamp(14px, 4vw, 18px);
    font-weight:700; padding:6px 10px; border-radius:999px;
    background: linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,.35));
    color:#fff; text-shadow:0 1px 0 rgba(0,0,0,.35);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.18);
    transition: background-color .2s, transform .15s;
  }
  .multiplier.low{ background:linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,.35)); }
  .multiplier.medium{ background:linear-gradient(180deg, rgba(255,193,7,.55), rgba(255,152,0,.6)); }
  .multiplier.high{ background:linear-gradient(180deg, rgba(76,255,171,.6), rgba(53,217,127,.65)); }

  /* Кнопка «Вывести» — выше середины, с пульсом */
  .withdraw{
    position:fixed; left:50%; top: 38vh;
    transform: translate(-50%, -50%) scale(1);
    padding:14px 22px;
    font-size:clamp(16px, 4.2vw, 18px); font-weight:800; color:#0b2b17;
    background: linear-gradient(180deg, var(--withdraw1), var(--withdraw2));
    border:none; border-radius:14px;
    box-shadow:0 12px 20px rgba(0,0,0,.2), inset 0 1px 0 rgba(255,255,255,.55);
    cursor:pointer; opacity:0; pointer-events:none; z-index:12;
    transition: opacity .25s ease;
    touch-action: manipulation;
  }
  .withdraw.show{
    opacity:1; pointer-events:auto;
    animation: pulse 1.4s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ transform: translate(-50%, -50%) scale(1); box-shadow:0 12px 20px rgba(0,0,0,.2), inset 0 1px 0 rgba(255,255,255,.55); }
    50%{ transform: translate(-50%, -50%) scale(1.06); box-shadow:0 16px 26px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.55); }
  }

  /* Поп-слой для +деньги */
  .pop-global{ position:fixed; inset:0; pointer-events:none; overflow:visible; z-index:15; }
  .pop-global span{
    position:absolute; font-weight:900; color:#fff;
    text-shadow:0 2px 0 rgba(0,0,0,.35);
    opacity:0; animation: popmoney 900ms ease-out forwards; white-space:nowrap; user-select:none;
  }
  @keyframes popmoney{
    0%{ transform:translateY(0) scale(.9); opacity:0}
    15%{ opacity:1}
    100%{ transform:translateY(-80px) scale(1.12); opacity:0}
  }

  /* ===== iPhone-уведомление (БЕЗ изменений стиля) ===== */
  .ios-banner{
    position:fixed;
    left:50%;
    top: calc(env(safe-area-inset-top) + 6px);
    transform: translate(-50%, -140%);
    width: calc(100vw - 24px);
    max-width: 600px;
    background: linear-gradient(180deg, rgba(255, 255, 255, .94), rgba(235, 238, 243, .95));
    color: #000;
    border-radius: 18px;
    padding: 10px 14px;
    box-shadow: 0 18px 28px rgba(0, 0, 0, .25);
    display: flex;
    align-items: center;
    gap: 10px;
    transition: transform .5s cubic-bezier(.2,.9,.2,1.1);
    z-index: 20;
    border: 1px solid rgba(0, 0, 0, .08);
  }
  .ios-banner.show{ transform: translate(-50%, 0); }
  .ios-avatar{ flex:0 0 auto; position:relative; }
  .ios-avatar::before, .ios-avatar::after{ content:none; }
  .ios-avatar-img{ display:block; height:44px; width:auto; }
  .ios-content{ flex:1; min-width:0; }
  .ios-top{ display:flex; justify-content:space-between; align-items:center; margin-top:2px; }
  .ios-sender{ font-weight:700; font-size:16px; }
  .ios-time{ font-size:15px; opacity:.55; line-height:1; }
  .ios-text{ margin-top:2px; line-height:1.28; font-size:15px; }
  .ios-imsg{ display:none !important; }
  .ios-imsg::after{ content:none; }

  .toast{
    position:fixed; left:50%; bottom: calc(24px + env(safe-area-inset-bottom));
    transform:translate(-50%, 40px);
    background:rgba(30,30,32,.95); color:#fff; padding:10px 14px;
    border-radius:12px; font-size:14px; box-shadow:0 10px 20px rgba(0,0,0,.25);
    opacity:0; transition: transform .3s ease, opacity .3s ease; z-index:25;
  }
  .toast.show{ transform:translate(-50%, 0); opacity:1; }

  /* ===== Модальное окно промо ===== */
  .modal-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.45); backdrop-filter: blur(6px); display:grid; place-items:center; opacity:0; pointer-events:none; transition: opacity .25s ease; z-index:50; }
  .modal-overlay.show{ opacity:1; pointer-events:auto; }
  .modal{
    width:min(560px, 92vw);
    background:linear-gradient(180deg, #ffffff, #f4f6fb);
    border-radius:18px; padding:18px 18px 16px;
    box-shadow:0 18px 36px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.6);
    color:#0b1020;
  }
  .modal-header{ display:flex; align-items:center; gap:10px; margin-bottom:6px; }
  .modal-emoji{ font-size:28px; }
  .modal-title{ font-weight:800; font-size:18px; margin:0; }
  .modal-body{ font-size:15px; line-height:1.45; margin-top:6px; }
  .modal-actions{ margin-top:14px; display:flex; gap:10px; }
  .modal a{
    display:inline-block; text-decoration:none; font-weight:800; color:#0b2b17;
    background:linear-gradient(180deg, var(--withdraw1), var(--withdraw2));
    padding:10px 14px; border-radius:12px; box-shadow:0 10px 18px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.55);
  }
  .modal-close{ margin-left:auto; background:transparent; border:none; font-size:22px; cursor:pointer; line-height:1; padding:6px; }
</style>
</head>
<body>
  <!-- фон-облака -->
  <div class="clouds" aria-hidden="true">
    <div class="cloud" style="left:-30vw; --s:1;"></div>
    <div class="cloud c2"></div>
    <div class="cloud c3"></div>
  </div>

  <!-- СМС (как раньше) -->
  <div class="ios-banner" id="iosBanner" role="button" tabindex="0" aria-label="Уведомление СМС">
    <div class="ios-avatar" aria-hidden="true"><img src="avatar.png" alt="" class="ios-avatar-img"></div>
    <div class="ios-content">
      <div class="ios-top">
        <div class="ios-sender">900</div>
        <div class="ios-time" id="iosTime">сейчас</div>
      </div>
      <div class="ios-text"><span id="iosBody">ECMC3457 00:00 Пополнение 0 р Баланс: ……</span></div>
    </div>
  </div>

  <div class="toast" id="toast">это так не работает к сожалению</div>

  <main class="game" role="main">
    <!-- Бейдж баланса -->
    <div class="cash" id="cashBadge" aria-live="polite">
      <div class="cash-icon">₽</div>
      <div class="cash-amt" id="balance">0</div>
    </div>

    <!-- HUD над кнопкой -->
    <div class="hud">
      <div class="multiplier low" id="multiplier">×1.00</div>
    </div>

    <!-- Большая кнопка у дна -->
    <div class="bigbtn-wrap">
      <div class="base" aria-hidden="true"></div>
      <button class="bigbtn" id="moneyBtn" aria-label="Заработать">БАБЛО</button>
    </div>

    <!-- «Вывести» — выше середины -->
    <button class="withdraw" id="withdrawBtn">Вывести</button>

    <!-- Поп-слой -->
    <div class="pop-global" id="popGlobal" aria-hidden="true"></div>
  </main>

  <!-- Модальное окно -->
  <div class="modal-overlay" id="promoModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div class="modal-emoji" aria-hidden="true">🚜</div>
        <h2 class="modal-title" id="modalTitle">Полезный апгрейд</h2>
        <button class="modal-close" id="modalClose" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body">
        Подписывайся на канал Вадима Миронова, выигрывай наушники и записывайся на карьерную консультацию.
      </div>
      <div class="modal-actions">
        <a href="https://t.me/ipVadimMironov" target="_blank" rel="noopener">Открыть канал</a>
      </div>
    </div>
  </div>

<script>
(() => {
  const btn = document.getElementById('moneyBtn');
  const wd  = document.getElementById('withdrawBtn');
  const multiEl = document.getElementById('multiplier');

  const banner = document.getElementById('iosBanner');
  const iosTime = document.getElementById('iosTime');
  const iosBody = document.getElementById('iosBody');

  const popGlobal = document.getElementById('popGlobal');
  const toast = document.getElementById('toast');

  const cashAmt = document.getElementById('balance');
  const cashBadge = document.getElementById('cashBadge');

  const modal = document.getElementById('promoModal');
  const modalClose = document.getElementById('modalClose');

  function openModal(){ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }
  function closeModal(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }

  modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
  modalClose.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

  let clicks = 0;
  let balance = 0;

  const basePerClick = 100;

  // Параметры темпа
  const fastWindow = 150;
  const comboStep  = 0.10;
  const comboMax   = 3.0;
  const slowStart  = 300;
  const slowEnd    = 2500;
  const slowMax    = 2.5;

  let combo = 0;
  let lastTap = 0;

  const fmt = new Intl.NumberFormat('ru-RU');

  function updateBalance(){
    cashAmt.textContent = fmt.format(balance);
    cashBadge.classList.add('glow');
    setTimeout(()=> cashBadge.classList.remove('glow'), 300);
  }

  function updateMultiplierDisplay(comboMul, chargeMul){
    const total = comboMul * chargeMul;
    multiEl.textContent = `×${total.toFixed(2)}`;
    multiEl.classList.remove('low','medium','high');
    multiEl.style.transform = 'scale(1.05)';
    setTimeout(()=>{ multiEl.style.transform = 'scale(1)'; }, 140);

    if (total < 1.5) multiEl.classList.add('low');
    else if (total < 2.5) multiEl.classList.add('medium');
    else multiEl.classList.add('high');
  }

  // всплывающая сумма в верхней половине
  function randMoneyPop(text){
    const span = document.createElement('span');
    span.textContent = text;
    const vw = window.innerWidth;
    const vh = window.innerHeight;
    const padding = 0.06;
    const minX = vw * padding, maxX = vw * (1 - padding);
    const minY = vh * 0.06,   maxY = vh * 0.46;
    const x = Math.random() * (maxX - minX) + minX;
    const y = Math.random() * (maxY - minY) + minY;
    span.style.left = x + 'px';
    span.style.top  = y + 'px';
    span.style.fontSize = Math.max(18, Math.min(vw * 0.06, 28)) + 'px';
    span.style.textShadow = '0 2px 0 rgba(0,0,0,.35), 0 0 12px rgba(77,255,179,.55)';
    popGlobal.appendChild(span);
    setTimeout(() => span.remove(), 950);
  }

  // Нажатие — плавно -20px по размеру (через масштаб)
  function pressedScale(){
    const s = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--btn-size'));
    if (!s || isNaN(s)) return 0.96;
    return (s - 20) / s;
  }
  function pressDown(){
    btn.style.setProperty('--scale', pressedScale());
    btn.style.setProperty('--cx', '34%');
    btn.style.setProperty('--cy', '22%');
    btn.style.filter = 'brightness(1.02) saturate(1.06)';
    btn.style.boxShadow = 'inset 0 -12px 22px rgba(0,0,0,.25), inset 0 8px 18px rgba(255,255,255,.22), 0 14px 28px rgba(0,0,0,.32), 0 0 0 6px rgba(139,94,0,.18)';
  }
  function pressUp(){
    btn.style.setProperty('--scale', 1);
    btn.style.setProperty('--cx', '30%');
    btn.style.setProperty('--cy', '25%');
    btn.style.filter = 'none';
    btn.style.boxShadow = '';
  }
  btn.addEventListener('pointerdown', pressDown);
  ['pointerup','pointerleave','pointercancel'].forEach(ev=>btn.addEventListener(ev, pressUp));

  // === Игровая логика ===
  btn.addEventListener('click', () => {
    const now = performance.now();
    const dt = lastTap ? (now - lastTap) : Infinity;
    lastTap = now;

    // быстрые тапы = combo
    if (dt <= fastWindow) {
      combo = Math.min(combo + 1, Math.floor((comboMax - 1) / comboStep));
    } else if (dt > 400) {
      combo = Math.max(0, combo - 1);
    }
    const comboMul = Math.min(1 + combo * comboStep, comboMax);

    // пауза = charge
    let chargeMul = 1;
    if (dt >= slowStart && dt <= slowEnd) {
      const t = (dt - slowStart) / (slowEnd - slowStart);
      chargeMul = 1 + t * (slowMax - 1);
    } else if (dt > slowEnd) {
      combo = 0;
      chargeMul = slowMax;
    }

    updateMultiplierDisplay(comboMul, chargeMul);

    const gain = Math.round(basePerClick * comboMul * chargeMul);

    clicks++;
    balance += gain;
    updateBalance();
    randMoneyPop(`+${fmt.format(gain)} ₽`);

    if (clicks >= 5) wd.classList.add('show');
  }, {passive:true});

  // «Вывести» — задержка 0.5 с до показа уведомления
  wd.addEventListener('click', () => {
    if (balance <= 0) return;

    const now = new Date();
    const hhmm = now.toLocaleTimeString('ru-RU', {hour:'2-digit', minute:'2-digit'});
    const sumText = fmt.format(balance).replace(/\s/g,' ');
    iosTime.textContent = 'сейчас';
    iosBody.textContent = `ECMC3457 ${hhmm} Пополнение ${sumText} р Баланс: ……`;

    setTimeout(() => {
      banner.classList.add('show');
      setTimeout(() => banner.classList.remove('show'), 4000);
    }, 500);

    // сброс
    clicks = 0;
    balance = 0;
    combo = 0;
    lastTap = 0;
    updateBalance();
    updateMultiplierDisplay(1,1);
    wd.classList.remove('show');
  }, {passive:true});

  // Клик по баннеру — создаём второе уведомление «Оно так не работает»
  function spawnInfoBanner(){
    const existing = document.getElementById('extraBanner');
    if (existing) existing.remove();

    const extra = document.createElement('div');
    extra.className = 'ios-banner';
    extra.id = 'extraBanner';
    extra.setAttribute('role','button');
    extra.setAttribute('tabindex','0');
    extra.setAttribute('aria-label','Уведомление СМС');

    const avatar = document.createElement('div');
    avatar.className = 'ios-avatar';
    const img = document.createElement('img');
    img.src = 'avatar.png'; img.alt = ''; img.className = 'ios-avatar-img';
    avatar.appendChild(img);

    const content = document.createElement('div');
    content.className = 'ios-content';

    const top = document.createElement('div');
    top.className = 'ios-top';
    const sender = document.createElement('div'); sender.className = 'ios-sender'; sender.textContent = '900';
    const time = document.createElement('div'); time.className = 'ios-time'; time.textContent = 'сейчас';
    top.appendChild(sender); top.appendChild(time);

    const text = document.createElement('div');
    text.className = 'ios-text';
    const bodySpan = document.createElement('span'); bodySpan.id = 'iosBodyExtra'; bodySpan.textContent = 'Оно так не работает';
    text.appendChild(bodySpan);

    content.appendChild(top);
    content.appendChild(text);

    extra.appendChild(avatar);
    extra.appendChild(content);

    document.body.appendChild(extra);
    requestAnimationFrame(()=> extra.classList.add('show'));

    const onOpen = () => { openModal(); extra.remove(); };
    extra.addEventListener('click', onOpen);
    extra.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); onOpen(); }});
  }

    // Обновляем поведение клика по главному баннеру
  banner.addEventListener('click', spawnInfoBanner);
  banner.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); spawnInfoBanner(); }});
  
  // Старт
  updateBalance();
  updateMultiplierDisplay(1,1);
})();
</script>
</body>
</html>
